<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Video to Spritesheet Generator</title>
    <script>
        const storedTheme = localStorage.getItem('color-scheme');
        const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
        const theme = storedTheme || (prefersDark ? 'dark' : 'light');
        document.documentElement.setAttribute('data-color-scheme', theme);
        document.documentElement.setAttribute('data-bs-theme', theme);
    </script>
    <link rel="stylesheet" href="css/base.css">
    <link rel="stylesheet" href="css/components.css">

    <link href="https://cdn.jsdelivr.net/npm/bootswatch@5.3.2/dist/materia/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet" href="css/theme.css">
    <link rel="stylesheet" href="css/modern.css">
</head>
<body>
    <header class="app-header">
        <div class="header-left">
            <a class="logo" href="#">
                <span class="material-icons">movie</span>
                <span class="product-name">Spritesheet Maker</span>
            </a>
        </div>
        <div class="header-center">
            <input type="search" class="search-input" placeholder="Search or type /" aria-label="Search" />
        </div>
        <div class="header-right">
            <button id="themeToggle" class="icon-btn" type="button" aria-label="Toggle theme">
                <span class="material-icons" id="themeIcon">dark_mode</span>
            </button>
        </div>
    </header>

    <section class="title-bar container">
        <h1 class="title">Video to Spritesheet Generator</h1>
        <p class="subtitle">Convert video files into sprite sheets with customizable settings</p>
    </section>

    <main class="container my-4">
        <div class="row g-4">
            <div id="mainColumn" class="col-12">
                <!-- Upload Section -->
                <section class="card mb-4">
                    <div class="card-body">
                        <h2 class="h4 mb-3">1. Upload Video</h2>
                        <div class="drop-zone" id="dropZone">
                            <div class="drop-zone__content">
                                <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                    <polyline points="14,2 14,8 20,8"></polyline>
                                    <line x1="16" y1="13" x2="8" y2="13"></line>
                                    <line x1="16" y1="17" x2="8" y2="17"></line>
                                    <polyline points="10,9 9,9 8,9"></polyline>
                                </svg>
                                <p class="mb-1">Drag and drop a video file here</p>
                                <p class="text-secondary small">or</p>
                                <button type="button" class="btn btn-primary" id="fileSelectBtn">Select Video File</button>
                                <input type="file" id="fileInput" accept="video/mp4,video/webm,video/mov,video/avi,video/mkv" style="display: none;">
                            </div>
                        </div>
                        <div class="file-info hidden mt-3" id="fileInfo">
                            <h4 class="h6">File Information</h4>
                            <div class="file-details d-flex gap-2">
                                <span class="file-name" id="fileName"></span>
                                <span class="file-size" id="fileSize"></span>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Video Section -->
                <section class="card mb-4 hidden" id="videoSection">
                    <div class="card-body">
                        <h2 class="h4 mb-3">2. Video Preview</h2>
                        <div class="video-container text-center">
                            <video id="videoPlayer" controls class="w-100">
                                Your browser does not support the video tag.
                            </video>
                            <canvas id="videoCanvas" class="hidden w-100"></canvas>
                        </div>
                        <div class="form-check mt-3">
                            <input class="form-check-input" type="checkbox" id="videoTransparentBgToggle">
                            <label class="form-check-label" for="videoTransparentBgToggle">Replace black background with transparency</label>
                        </div>
                        <div class="video-info mt-3" id="videoInfo">
                            <div class="video-metadata d-flex flex-wrap gap-3">
                                <span id="videoDuration"></span>
                                <span id="videoResolution"></span>
                                <span id="videoFrameRate"></span>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Settings Section -->
                <section class="card mb-4" id="settingsSection">
                    <div class="card-body">
                        <h2 class="h4 mb-3">3. Settings</h2>
                        <p class="text-secondary" id="settingsHelp">Upload a video first to enable generation settings</p>
                        <div class="row g-3" id="settingsGrid">
                            <div class="setting-group col-md-6">
                                <label class="form-label" for="fpsSlider">
                                    Frame Rate: <span id="fpsValue">30</span> FPS
                                </label>
                                <input type="range" id="fpsSlider" class="form-range" min="24" max="120" value="30" step="1">
                                <div class="d-flex justify-content-between small">
                                    <span>24</span>
                                    <span>120</span>
                                </div>
                            </div>

                            <div class="setting-group col-md-6">
                                <label class="form-label">Time Range</label>
                                <div class="row g-2">
                                    <div class="col">
                                        <label class="form-label small">Start Time (seconds)</label>
                                        <input type="number" id="startTime" class="form-control" min="0" step="0.1" placeholder="0" value="0">
                                    </div>
                                    <div class="col">
                                        <label class="form-label small">End Time (seconds)</label>
                                        <input type="number" id="endTime" class="form-control" min="0" step="0.1" placeholder="Auto">
                                    </div>
                                </div>
                                <div class="time-range-info">
                                    <small class="text-secondary" id="timeRangeInfo">Full video duration will be used</small>
                                </div>
                            </div>

                            <div class="setting-group col-md-6">
                                <label class="form-label" for="resolutionSelect">Sprite Resolution</label>
                                <select id="resolutionSelect" class="form-select">
                                    <option value="same">Same as video</option>
                                    <option value="64">64×64</option>
                                    <option value="128">128×128</option>
                                    <option value="256">256×256</option>
                                    <option value="512">512×512</option>
                                    <option value="1024">1024×1024</option>
                                    <option value="custom">Custom size</option>
                                </select>
                            </div>

                            <div class="setting-group col-md-6 hidden" id="customResolutionGroup">
                                <label class="form-label">Custom Resolution</label>
                                <div class="row g-2">
                                    <div class="col">
                                        <label class="form-label small">Width</label>
                                        <input type="number" id="customWidth" class="form-control" min="1">
                                    </div>
                                    <div class="col">
                                        <label class="form-label small">Height</label>
                                        <input type="number" id="customHeight" class="form-control" min="1">
                                    </div>
                                </div>
                                <div class="aspect-info small text-secondary" id="aspectRatioInfo"></div>
                            </div>

                            <div class="setting-group col-md-6">
                                <label class="form-label" for="gridModeSelect">Grid Mode</label>
                                <select id="gridModeSelect" class="form-select">
                                    <option value="columns">Calculate Columns</option>
                                    <option value="rows">Calculate Rows</option>
                                    <option value="custom">Custom</option>
                                </select>
                            </div>

                            <div class="setting-group col-md-6 hidden" id="customColumnsGroup">
                                <label class="form-label" for="customColumns">Columns</label>
                                <input type="number" id="customColumns" class="form-control" min="1" value="1">
                            </div>

                            <div class="setting-group col-md-6">
                                <label class="form-label" for="filenameInput">File Name</label>
                                <input type="text" id="filenameInput" class="form-control" placeholder="spritesheet">

                            </div>
                        </div>
                        <div class="aspect-info small text-secondary" id="aspectRatioInfo"></div>
                    </div>


                        <div class="d-flex gap-2 mt-4" id="generationControls">
                            <button type="button" class="btn btn-primary" id="generateBtn">Generate Spritesheet</button>
                            <button type="button" class="btn btn-secondary" id="cancelBtn">Cancel</button>
                        </div>

                        <div class="progress mt-3 hidden" id="progressContainer">
                            <div class="progress-bar" role="progressbar" id="progressFill" style="width:0%"></div>
                        </div>
                        <p class="small mt-2" id="progressText"></p>
                    </div>
                </section>
            </div>
            <div id="previewColumn" class="col-12 col-lg-6 hidden">
                <!-- Preview Section -->
                <section class="card mb-4" id="previewSection">
                    <div class="card-body">
                        <h2 class="h4 mb-3">4. Spritesheet Preview</h2>
                        <div class="d-flex flex-wrap gap-3 mb-3">
                            <span id="frameCount"></span>
                            <span>Grid Size: <strong id="gridSize">0×0</strong></span>
                            <span>Full Size: <strong id="sheetSize">0×0</strong></span>
                            <span>Preview Size: <strong id="previewSize">0×0</strong></span>
                        </div>
                        <div class="preview-container mb-3">
                            <div class="d-flex gap-2 mb-2">
                                <button type="button" class="btn btn-outline-secondary btn-sm" id="zoomInBtn">
                                    <span class="material-icons align-middle">zoom_in</span>
                                </button>
                                <button type="button" class="btn btn-outline-secondary btn-sm" id="zoomOutBtn">
                                    <span class="material-icons align-middle">zoom_out</span>
                                </button>
                                <button type="button" class="btn btn-outline-secondary btn-sm" id="resetZoomBtn">
                                    <span class="material-icons align-middle">refresh</span>
                                </button>
                            </div>
                            <div class="canvas-wrapper" id="canvasWrapper">
                                <canvas id="previewCanvas"></canvas>
                            </div>

                        </div>
                        <div class="gif-preview-container mb-3">
                            <h3 class="h6">Animation Preview</h3>
                            <canvas id="animationPreview" class="gif-preview hidden"></canvas>
                        </div>
                        <div class="form-check mb-3">
                            <input class="form-check-input" type="checkbox" id="transparentBgToggle">
                            <label class="form-check-label" for="transparentBgToggle">
                                Replace black background with transparency
                            </label>
                        </div>
                        <div class="crop-controls mb-3">
                            <button type="button" class="btn btn-secondary w-100" id="cropBtn" disabled>Crop Sprites</button>
                        </div>
                        <div class="export-controls">
                            <button type="button" class="btn btn-primary w-100" id="exportBtn">
                                Export PNG (Full Resolution)
                            </button>
                            <div class="export-status hidden mt-2" id="exportStatus">
                                <span class="status-text">Preparing download...</span>
                            </div>
                        </div>
                    </div>
                </section>
            </div>
        </div>

    </main>
    <div id="cropOverlay" class="crop-overlay hidden">
        <div class="crop-modal card">
            <div class="card-body">
                <div class="crop-container">
                    <canvas id="cropCanvas"></canvas>
                    <canvas id="gridCanvas" class="grid-overlay hidden"></canvas>
                    <div id="cropBox" class="crop-box hidden">
                        <span id="cropLabel" class="crop-label"></span>

                        <div class="handle handle-n"></div>
                        <div class="handle handle-e"></div>
                        <div class="handle handle-s"></div>
                        <div class="handle handle-w"></div>
                        <div class="handle handle-ne"></div>
                        <div class="handle handle-nw"></div>
                        <div class="handle handle-se"></div>
                        <div class="handle handle-sw"></div>
                    </div>
                </div>
                <div class="crop-controls mt-3">
                    <div class="ratio-select mb-3">
                        <label for="cropRatio" class="form-label">Aspect Ratio</label>
                        <select id="cropRatio" class="form-select">
                            <option value="free">Free</option>
                            <option value="1:1">Square 1:1</option>
                            <option value="4:5">Portrait 4:5</option>
                            <option value="4:3">Photo 4:3</option>
                            <option value="16:9">Landscape 16:9</option>
                        </select>
                    </div>
                    <div class="grid-controls mb-3">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="gridToggle">
                            <label class="form-check-label" for="gridToggle">Grid</label>
                        </div>
                        <select id="gridType" class="form-select mt-2">
                            <option value="thirds">Rule of Thirds</option>
                            <option value="golden">Golden Ratio</option>
                        </select>
                    </div>
                    <div class="manual-controls mb-3">
                        <div class="row g-2">
                            <div class="col">
                                <label class="form-label">X</label>
                                <input type="number" id="cropX" class="form-control" min="0" value="0">
                            </div>
                            <div class="col">
                                <label class="form-label">Y</label>
                                <input type="number" id="cropY" class="form-control" min="0" value="0">
                            </div>
                            <div class="col">
                                <label class="form-label">W</label>
                                <input type="number" id="cropWidth" class="form-control" min="1" value="0">
                            </div>
                            <div class="col">
                                <label class="form-label">H</label>
                                <input type="number" id="cropHeight" class="form-control" min="1" value="0">
                            </div>
                        </div>
                        <div class="form-check mt-2">
                            <input class="form-check-input" type="checkbox" id="lockAspect">
                            <label class="form-check-label" for="lockAspect">Lock</label>
                        </div>
                    </div>
                    <div class="transform-controls d-flex flex-wrap gap-2 mb-3">
                        <button type="button" class="btn btn-outline-secondary btn-sm" id="rotateLeftBtn">Rotate -90°</button>
                        <button type="button" class="btn btn-outline-secondary btn-sm" id="rotateRightBtn">Rotate +90°</button>
                        <button type="button" class="btn btn-outline-secondary btn-sm" id="flipHBtn">Flip H</button>
                        <button type="button" class="btn btn-outline-secondary btn-sm" id="flipVBtn">Flip V</button>
                    </div>

                    <div class="crop-zoom-controls d-flex gap-2 mb-3">
                        <button type="button" class="btn btn-outline-secondary btn-sm" id="cropZoomInBtn">Zoom In</button>
                        <button type="button" class="btn btn-outline-secondary btn-sm" id="cropZoomOutBtn">Zoom Out</button>
                    </div>

                    <div class="crop-actions d-flex gap-2">
                        <button type="button" class="btn btn-primary" id="confirmCropBtn">Confirm Crop</button>
                        <button type="button" class="btn btn-secondary" id="cancelCropBtn">Cancel</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="js/SpritesheetGenerator.js"></script>
    <script src="js/main.js"></script>
</body>
</html>
